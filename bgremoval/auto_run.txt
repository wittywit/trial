@echo off
REM Start the Python HTTP server
start python -m http.server 8000

REM Establish the Serveo.net tunnel
REM The SSH command connects to serveo.net and forwards localhost:8000 to a public URL
start ssh -R 80:localhost:8000 serveo.net

REM Wait a few seconds to ensure the tunnel is up
timeout /t 10 > nul

REM Capture the Serveo URL and update the webcam.js file
for /f "tokens=2 delims=:" %%i in ('curl http://localhost:8000') do (
    set url=%%i
)

REM Update the webcam.js file with the new URL
powershell -Command "(Get-Content webcam.js) -replace 'https://.*\.serveo\.net', 'https://%url%.serveo.net' | Set-Content webcam.js"
