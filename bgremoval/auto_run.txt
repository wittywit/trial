REM Start the Python HTTP server
start python -m http.server 8000

REM Establish the Serveo.net tunnel and get the URL
start ssh -R 80:localhost:8000 serveo.net > serveo_url.txt

REM Wait a few seconds to ensure the tunnel is up and URL is written to the file
timeout /t 10 > nul

REM Extract the Serveo URL from the text file
for /f "tokens=5" %%i in ('findstr /C:"Forwarding" serveo_url.txt') do (
    set url=%%i
)

REM Update the webcam.js file with the new URL using PowerShell
powershell -Command "(Get-Content webcam.js) | ForEach-Object { $_ -replace 'https://.*\.serveo\.net', '%url%' } | Set-Content webcam.js"

REM Clean up the Serveo URL file
del serveo_url.txt
